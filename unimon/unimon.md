# Unimon (мониторинг) — шпаргалка для ИПР

## Что это
Unimon — система мониторинга из стека Platform V (СберТех). Собирает прикладные и инфраструктурные метрики/события, выполняет health‑check и отправляет данные в централизованную шину (обычно Kafka) для последующего анализа и алертинга.

## Принцип работы (в 1 строку)
Приложение → `unimon-sender`/`unimon-agent` → Kafka (топик) → консьюмеры мониторинга/алертинга (дашборды, правила, хранилища).

## Компоненты
- unimon-agent - отвечает за непосредственный сбор метрик  с контейнеров и временное хранение данных до отправки
- unimon-sender - служит промежуточной точкой приема  и дальнейшей пересылки метрик в центральную систему мониторинга

в деплойменте вижу еще одну поду unimon-agent-only, но она 0/0, зачем она?

в поде приклада есть сайд-кар fluent-bit - читает стандартный вывод, формируется логи для тенги и отправляет их в кафку

## Push vs Pull (коротко)
- **Push (Unimon):** клиент сам отправляет метрики/события в Kafka. Масштабируется линейно с числом продьюсеров; хорошо для event‑driven потоков.  
- **Pull (Prometheus):** сервер опрашивает `/metrics` у целей по расписанию; просто и прозрачно, но требует доступности целей и сетевой досягаемости.

### Когда push удобнее
- Высокочастотные события/лог‑метрики, шиппинг в Kafka/обработчики стримов.  
- Изолированные среды (нет входящих соединений к подам).  
- Необходима буферизация/ретраи на стороне клиента.

### Когда pull удобнее
- Простая эксплуатация, авто‑дискавери целей (ServiceMonitor/PodMonitor).  
- «Снимки» состояния с контролем частоты опроса.  

## Почему Kafka «подходит» push‑модели
- Kafka — шина событий с высокой пропускной способностью и долговечным логом.  
- Продьюсеры (sender/agent) публикуют метрики/события в топики; консьюмеры (алертинг/хранилища/дашборды) читают и обрабатывают их независимо.  
- Поддерживаются ретраи, компрессия, партиционирование и репликация для устойчивости и масштаба.

## Мини‑ответы для ИПР
- **Что такое Unimon?** Система мониторинга Platform V для сбора метрик/health‑событий и их доставки в централизованную шину (Kafka) с последующей обработкой и алертингом.  
- **unimon‑sender vs unimon‑agent?** Sender — библиотека внутри приложения (формирует метрики и health‑endpoint); Agent — отдельный сервис/sidecar, агрегирует и шиппит метрики.  
- **Модель сбора?** Push‑модель (клиент → Kafka). В отличие от Prometheus (pull).  
- **Подходит ли для Kafka?** Да. Kafka оптимизирована под потоковые события; дальше метрики разбирают консьюмеры мониторинга.

## Заметки по k8s
- `unimon-sender` идёт зависимостью в сервис; `unimon-agent` можно запускать как **sidecar** рядом с контейнером приложения.  
- Сетевые политики/секреты: доступ к Kafka (SASL/TLS), топики, ключи.  
- Нагрузочные тонкости: размер батчей, таймауты, ретраи, бэкофф, лимиты CPU/RAM у sidecar.

---

© Для подготовки к ИПР: держи это как краткую памятку; при необходимости расширить разделы «k8s» и «алертинг» под конкретную площадку.
