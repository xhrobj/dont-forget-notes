# –ö–æ–Ω—Ç–µ–Ω—à–Ω –∏ –î–µ–¥–ª–æ–∫ –≤ Java

---

## üß© –ß—Ç–æ —Ç–∞–∫–æ–µ –º–æ–Ω–∏—Ç–æ—Ä –∏ –∑–∞–º–æ–∫

–í Java **–∫–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç** (`Object`) –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ ‚Äî **–º–æ–Ω–∏—Ç–æ—Ä**.  
–ö–æ–≥–¥–∞ –ø–æ—Ç–æ–∫ –∑–∞—Ö–æ–¥–∏—Ç –≤ –±–ª–æ–∫ `synchronized (obj) { ... }`, –æ–Ω **–∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä** –æ–±—ä–µ–∫—Ç–∞ `obj`.  
–î—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏, –ø—ã—Ç–∞—é—â–∏–µ—Å—è –≤–æ–π—Ç–∏ –≤ —Ç–æ—Ç –∂–µ `synchronized (obj)`, –≤—ã–Ω—É–∂–¥–µ–Ω—ã –∂–¥–∞—Ç—å, –ø–æ–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è.

> üí¨ –¢–µ—Ä–º–∏–Ω—ã **–º–æ–Ω–∏—Ç–æ—Ä** –∏ **–∑–∞–º–æ–∫ (lock)** —á–∞—Å—Ç–æ —É–ø–æ—Ç—Ä–µ–±–ª—è—é—Ç—Å—è –∫–∞–∫ —Å–∏–Ω–æ–Ω–∏–º—ã,  
> –Ω–æ —Å—Ç—Ä–æ–≥–æ –≥–æ–≤–æ—Ä—è, –º–æ–Ω–∏—Ç–æ—Ä ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∑–∞–º–æ–∫ –æ–±—ä–µ–∫—Ç–∞,  
> –∞ lock –º–æ–∂–µ—Ç –±—ã—Ç—å –∏ ¬´—Ä—É—á–Ω—ã–º¬ª (`ReentrantLock`, `ReadWriteLock`).

---

## ‚öôÔ∏è –ö–æ–Ω—Ç–µ–Ω—à–Ω (Contention)

### –ß—Ç–æ —ç—Ç–æ
**–ö–æ–Ω—Ç–µ–Ω—à–Ω** ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ —Ö–æ—Ç—è—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ä–µ—Å—É—Ä—Å (–º–æ–Ω–∏—Ç–æ—Ä),  
–Ω–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –µ–≥–æ —É–∂–µ –¥–µ—Ä–∂–∏—Ç, –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∂–¥—É—Ç.  
–°–∏—Ç—É–∞—Ü–∏—è —Ä–∞–∑—Ä–µ—à–∏–º–∞—è: –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –≤—ã–π–¥–µ—Ç –∏–∑ `synchronized`, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç.

### –ü—Ä–∏–º–µ—Ä
```java
class ContentionDemo {
    private static final Object lock = new Object();

    public static void main(String[] args) {
        Runnable task = () -> {
            synchronized (lock) {
                System.out.println(Thread.currentThread().getName() + " –≤–æ—à—ë–ª");
                try { Thread.sleep(3000); } catch (InterruptedException ignored) {}
                System.out.println(Thread.currentThread().getName() + " –≤—ã—à–µ–ª");
            }
        };
        new Thread(task, "t1").start();
        new Thread(task, "t2").start();
    }
}
```

üß† –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- `t1` –≤–æ—à—ë–ª –≤ `synchronized` –∏ –¥–µ—Ä–∂–∏—Ç –º–æ–Ω–∏—Ç–æ—Ä `lock`;
- `t2` –ø—ã—Ç–∞–µ—Ç—Å—è –≤–æ–π—Ç–∏, –Ω–æ –≤–∏–¥–∏—Ç, —á—Ç–æ –∑–∞–º–æ–∫ –∑–∞–Ω—è—Ç ‚Üí `BLOCKED`;
- –∫–æ–≥–¥–∞ `t1` –≤—ã—Ö–æ–¥–∏—Ç, `t2` –∑–∞—Ö–æ–¥–∏—Ç ‚Äî –≤—Å—ë –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

### –í thread dump
```
"t1" RUNNABLE
  - locked <0x123> (a java.lang.Object)
"t2" BLOCKED
  - waiting to lock <0x123> (a java.lang.Object)
```

> üîé –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –∑–∞–º–æ–∫. JVM –Ω–µ –ø–∏—à–µ—Ç `Found one Java-level deadlock`.

---

## ‚ò†Ô∏è –î–µ–¥–ª–æ–∫ (Deadlock)

### –ß—Ç–æ —ç—Ç–æ
**–î–µ–¥–ª–æ–∫** ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –¥–≤–∞ (–∏–ª–∏ –±–æ–ª–µ–µ) –ø–æ—Ç–æ–∫–∞ –Ω–∞–≤–µ—á–Ω–æ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞.  
–ö–∞–∂–¥—ã–π –¥–µ—Ä–∂–∏—Ç —Å–≤–æ–π –∑–∞–º–æ–∫ –∏ –∂–¥—ë—Ç –∑–∞–º–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –¥–µ—Ä–∂–∏—Ç –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫.

### –ü—Ä–∏–º–µ—Ä
```java
class DeadlockDemo {
    private static final Object lockA = new Object();
    private static final Object lockB = new Object();

    public static void main(String[] args) {
        Thread t1 = new Thread(() -> {
            synchronized (lockA) {
                System.out.println("t1 –≤–∑—è–ª lockA");
                try { Thread.sleep(100); } catch (InterruptedException ignored) {}
                synchronized (lockB) {
                    System.out.println("t1 –≤–∑—è–ª lockB");
                }
            }
        });

        Thread t2 = new Thread(() -> {
            synchronized (lockB) {
                System.out.println("t2 –≤–∑—è–ª lockB");
                try { Thread.sleep(100); } catch (InterruptedException ignored) {}
                synchronized (lockA) {
                    System.out.println("t2 –≤–∑—è–ª lockA");
                }
            }
        });

        t1.start();
        t2.start();
    }
}
```

üß† –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- `t1` –¥–µ—Ä–∂–∏—Ç `lockA`, –∂–¥—ë—Ç `lockB`;
- `t2` –¥–µ—Ä–∂–∏—Ç `lockB`, –∂–¥—ë—Ç `lockA`;
- –æ–±–∞ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞ ‚Üí –Ω–∞–≤–µ—á–Ω–æ.

### –í thread dump
```
Found one Java-level deadlock:
"t1": waiting to lock <0xA> held by "t2"
"t2": waiting to lock <0xB> held by "t1"
```

> üîé –ó–¥–µ—Å—å JVM —è–≤–Ω–æ —Å–æ–æ–±—â–∞–µ—Ç –æ –¥–µ–¥–ª–æ–∫–µ ‚Äî –≤ –∫–æ–Ω—Ü–µ –¥–∞–º–ø–∞ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫.

---

## üìä –ì–ª–∞–≤–Ω–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ

| –ü—Ä–∏–∑–Ω–∞–∫ | –ö–æ–Ω—Ç–µ–Ω—à–Ω | –î–µ–¥–ª–æ–∫ |
|----------|-----------|---------|
| –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç | –ü–æ—Ç–æ–∫–∏ –∂–¥—É—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ä–µ—Å—É—Ä—Å | –ü–æ—Ç–æ–∫–∏ –∂–¥—É—Ç **–¥—Ä—É–≥ –¥—Ä—É–≥–∞** |
| –ò—Å—Ö–æ–¥ | –í—Å—ë —Ä–∞–∑—Ä–µ—à–∏—Ç—Å—è, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –≤—ã–π–¥–µ—Ç | –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—Å—è |
| Thread dump | –ï—Å—Ç—å BLOCKED, **–Ω–æ –Ω–µ—Ç** `Found one Java-level deadlock` | –ï—Å—Ç—å –±–ª–æ–∫ `Found one Java-level deadlock` |
| –°–∏–º–ø—Ç–æ–º—ã | –í–∏—Å–Ω–µ—Ç, –Ω–æ ¬´–æ–∂–∏–≤–∞–µ—Ç¬ª | –ù–∞–≤–µ—á–Ω–æ –∑–∞–≤–∏—Å–ª–æ |
| –õ–µ—á–µ–Ω–∏–µ | –£–∫–æ—Ä–æ—Ç–∏—Ç—å `synchronized`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Concurrent` —Å—Ç—Ä—É–∫—Ç—É—Ä—ã | –£–ø–æ—Ä—è–¥–æ—á–∏—Ç—å –∑–∞—Ö–≤–∞—Ç—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `tryLock` |
| –ü—Ä–∏–º–µ—Ä API | synchronized, ReentrantLock | synchronized (–≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ) |

---

## üß† –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

1. –§–∏–ª—å—Ç—Ä—É–π —Å–≤–æ–∏ –ø–æ—Ç–æ–∫–∏, –∏–≥–Ω–æ—Ä–∏—Ä—É–π —Å–ª—É–∂–µ–±–Ω—ã–µ (`GC`, `Finalizer`, –∏ —Ç.–¥.).  
2. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –º–Ω–æ–≥–æ `BLOCKED` –Ω–∞ –æ–¥–Ω–æ–º –æ–±—ä–µ–∫—Ç–µ ‚Üí —ç—Ç–æ **–∫–æ–Ω—Ç–µ–Ω—à–Ω**.  
3. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å `Found one Java-level deadlock` ‚Üí —ç—Ç–æ **–¥–µ–¥–ª–æ–∫**.  
4. –ß—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –¥–∏–Ω–∞–º–∏–∫—É ‚Äî —Å–Ω–∏–º–∏ **3‚Äì5 –¥–∞–º–ø–æ–≤** —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 5‚Äì10 —Å–µ–∫—É–Ω–¥.  
5. –î–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–∂–µ—à—å —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –æ–±–∞ –ø—Ä–∏–º–µ—Ä–∞ –≤—ã—à–µ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ö –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ VisualVM.

---
