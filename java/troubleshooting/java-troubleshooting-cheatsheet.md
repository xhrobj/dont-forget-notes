# –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ Java Troubleshooting (–ò–ü–†)

–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ –∞–≤–∞—Ä–∏—è—Ö/—Å–∏—Ç—É–∞—Ü–∏—è—Ö —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –Ω–∞ Java

-Xmx<size> ‚Äî –≤–µ—Ä—Ö–Ω–∏–π –ø—Ä–µ–¥–µ–ª heap‚Äô–∞ (Java-–∫—É—á–∏).
-Xss<size> ‚Äî —Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞ –Ω–∞ –∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ JVM.

—Ç–æ—Ä–º–æ–∑–∏—Ç java
1. gc –∏–ª–∏ –Ω–µ gc
  –≤–∫–ª—é—á–∞–µ–º gc log
  —Å–º–æ—Ç—Ä–∏–º –≤ gc viewer'–µ
  —Å–º–æ—Ç—Ä–∏–º –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∏
2. –Ω–æ –Ω–µ –≤—Å–µ –ø–∞—É–∑—ã –∏–∑-–∑–∞ gc, —Ç–æ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–æ —É –Ω–∞—Å safepoint'—ã
  –æ–ø—Ü–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ java –±—ã–ª–∞ –Ω–∞ –ø–∞—É–∑–µ:
  -XX:+PrintGCApplicationStoppedTime 
  –≤ java-11 –æ–ø—Ü–∏—è –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
  -Xlog:safepoint*=info
3. –Ω–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–µ—Ç –µ—â–µ —Ç–æ—Ä–º–æ–∑–∏—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ code cache –∫–æ–Ω—á–∏–ª–æ—Å—å –º–µ—Å—Ç–æ ...
  —Ç–æ–≥–¥–∞ –≤ stdout –Ω–∞–ø–µ—á–∞—Ç–∞–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞ "Complier has been disabled."
  —ç—Ç–æ–π –æ–ø—Ü–∏–µ–π –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –º–µ—Å—Ç–æ –ø–æ–¥ code cache
  -XX:ReservedCodeCacheSize=


---

## 1) Stacktrace

—Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞ –≤ 64-–±–∏—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 1–º–± –ø–æ –¥–µ—Ñ–æ–ª—Ç—É
–∫–ª—é—á–∏: -Xss, -XX:ThreadStackSize

–°—Ç–µ–∫ ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–ª—è –ø–æ—Ç–æ–∫–∞.
Heap/Metaspace/CodeCache ‚Äî –æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–∞ JVM.

–ü–æ–ª–µ–∑–Ω–æ –ø–æ–º–Ω–∏—Ç—å:
–ú–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤ √ó –±–æ–ª—å—à–æ–π -Xss = –∑–∞–º–µ—Ç–Ω–∞—è –ø–∞–º—è—Ç—å ¬´—Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç–µ–∫–∏¬ª.

–ì–ª—É–±–æ–∫–∞—è —Ä–µ–∫—É—Ä—Å–∏—è/–±–æ–ª—å—à–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã ‚Üí –Ω—É–∂–µ–Ω –±–æ–ª—å—à–∏–π —Å—Ç–µ–∫, –∏–Ω–∞—á–µ StackOverflowError.

–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: jcmd <pid> VM.native_memory summary (—Ä–∞–∑–¥–µ–ª Thread), jstack ‚Äî –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–µ–∫–æ–≤.

**–ó–∞—á–µ–º:** –ø–æ–Ω—è—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –æ—à–∏–±–∫–∏ –∏ —Ü–µ–ø–æ—á–∫—É –ø—Ä–∏—á–∏–Ω.
**–ö–∞–∫ —á–∏—Ç–∞—Ç—å:**
- –°–º–æ—Ç—Ä–∏ –Ω–∞ –Ω–∏–∂–Ω–∏–π **`Caused by`** ‚Äî —ç—Ç–æ –ø–µ—Ä–≤–æ–ø—Ä–∏—á–∏–Ω–∞; –≤—ã—à–µ ‚Äî –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è/–æ–±—ë—Ä—Ç–∫–∏.
- –ü–µ—Ä–≤—ã–µ 3‚Äì5 –∫–∞–¥—Ä–æ–≤ **—Ç–≤–æ–µ–≥–æ** –∫–æ–¥–∞ (–∞ –Ω–µ –±–∏–±–ª–∏–æ—Ç–µ–∫) ‚Äî –º–µ—Å—Ç–æ –≤—Ö–æ–¥–∞ –ø—Ä–æ–±–ª–µ–º—ã.
- **`Suppressed`** ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ try-with-resources).

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** IntelliJ IDEA ‚Üí *Analyze Stack Trace‚Ä¶* (–ø—Ä—ã–∂–æ–∫ –≤ –∫–æ–¥, —Ñ–∏–ª—å—Ç—Ä—ã, –ø–æ–∏—Å–∫ –ø–æ –∫–ª–∞—Å—Å–∞–º/–≤–µ—Ä—Å–∏—è–º).

–ù–∏–∂–µ ‚Äî —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã. –°–º–æ—Ç—Ä–∏ –Ω–∞ **–ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É** (—Ç–∏–ø+—Å–æ–æ–±—â–µ–Ω–∏–µ) –∏ –Ω–∞ **–ø–µ—Ä–≤—ã–µ –∫–∞–¥—Ä—ã —Ç–≤–æ–µ–≥–æ –∫–æ–¥–∞**.

**1) `NullPointerException` (–∏–º–ø–ª–∏—Ü–∏—Ç–Ω–æ–µ —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏–µ `null`)**
```
Exception in thread "main" java.lang.NullPointerException: Cannot invoke "String.length()" because "name" is null
    at com.acme.user.UserService.fullNameLen(UserService.java:17)   ‚Üê —Ç–≤–æ–π –∫–æ–¥
    at com.acme.user.UserController.handle(UserController.java:11)  ‚Üê —Ç–≤–æ–π –∫–æ–¥
    at com.acme.App.main(App.java:7)                                ‚Üê —Ç–≤–æ–π –∫–æ–¥
```
**–ö—É–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å:** –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —É–∂–µ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ `name` –±—ã–ª `null`. –û—Ç–∫—Ä–æ–π `UserService.java:17`.

**2) `NullPointerException` (—è–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `Objects.requireNonNull`)**
```
Exception in thread "main" java.lang.NullPointerException: userId must not be null
    at java.util.Objects.requireNonNull(Objects.java:... )
    at com.acme.user.UserService.load(UserService.java:22)          ‚Üê —Ç–≤–æ–π –∫–æ–¥
    at com.acme.App.main(App.java:7)                                ‚Üê —Ç–≤–æ–π –∫–æ–¥
```
**–ö—É–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å:** —Å–æ–æ–±—â–µ–Ω–∏–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—à—å —Å–∞–º ‚Äî –≤–∏–¥–Ω–æ, **–∫–∞–∫–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç** –Ω–∞—Ä—É—à–∏–ª –∫–æ–Ω—Ç—Ä–∞–∫—Ç.

**3) `IllegalArgumentException` (–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–µ–µ ‚Äî —Ç–≤–æ—è –≤–∞–ª–∏–¥–∞—Ü–∏—è)**
```
Exception in thread "main" java.lang.IllegalArgumentException: limit must be > 0
    at com.acme.search.QueryValidator.checkLimit(QueryValidator.java:14)  ‚Üê –º–µ—Å—Ç–æ throw
    at com.acme.search.SearchService.find(SearchService.java:28)          ‚Üê call-site
    at com.acme.App.main(App.java:7)
```
**–ö—É–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å:** –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî IAE —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º. –ò—Å–ø—Ä–∞–≤–ª—è–π –≤—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥/–≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

**4) `IllegalArgumentException` (IAE –∏–∑ JDK/–±–∏–±–ª–∏–æ—Ç–µ–∫–∏)**
```
Exception in thread "main" java.lang.IllegalArgumentException: Illegal capacity: -1
    at java.util.ArrayList.<init>(ArrayList.java:... )
    at com.acme.util.Lists.newListWithCap(Lists.java:9)              ‚Üê —Ç–≤–æ–π –∫–æ–¥ (call-site)
    at com.acme.App.main(App.java:7)
```
**–ö—É–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å:** –ø–µ—Ä–≤—ã–π ¬´–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π¬ª –∫–∞–¥—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, **–æ—Ç–∫—É–¥–∞ –≤—ã–∑–≤–∞–Ω API** —Å –ø–ª–æ—Ö–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º.

**5) `IllegalStateException` (–Ω–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞)**
```
Exception in thread "main" java.lang.IllegalStateException: service already stopped
    at com.acme.core.Lifecycle.ensureRunning(Lifecycle.java:31)     ‚Üê –º–µ—Å—Ç–æ throw/–ø—Ä–æ–≤–µ—Ä–∫–∞
    at com.acme.core.Service.doWork(Service.java:18)
    at com.acme.App.main(App.java:7)
```
**–ö—É–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å:** –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –Ω–∞—Ä—É—à–µ–Ω ‚Äî —á–∏–Ω–∏ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–æ–≤.

> –ü–∞–º—è—Ç–∫–∞: **NPE** ‚Äî –ø—Ä–æ —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏–µ `null`/–∞–≤—Ç–æ—Ä–∞—Å–ø–∞–∫–æ–≤–∫—É; **IAE** ‚Äî –º–µ—Ç–æ–¥ —Å–∞–º –±—Ä–æ—Å–∏–ª –∏–∑-–∑–∞ –ø–ª–æ—Ö–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞; **ISE** ‚Äî –Ω–µ–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞. –í IDEA: *Analyze ‚Üí Stack Trace‚Ä¶* –∏ –∫–ª–∏–∫–∞–π –ø–æ –ø–µ—Ä–≤—ã–º –∫–∞–¥—Ä–∞–º —Ç–≤–æ–µ–≥–æ –∫–æ–¥–∞. –î–ª—è —á–∞—Å—Ç–æ –±—Ä–æ—Å–∞–µ–º—ã—Ö NPE –±–µ–∑ —Å—Ç–µ–∫–∞ ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤—å `-XX:-OmitStackTraceInFastThrow`.

–¥–æ–±–∞–≤–ª–µ–Ω–æ ...

–ï—Å–ª–∏ —Å—Ç–µ–∫—Ç—Ä–µ–π—Å–∞ –Ω–µ—Ç, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫:

-XX:-OmitStackTraceInFastThrow –≤—ã–∫–ª—é—á–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é HotSpot, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π —É —á–∞—Å—Ç–æ –±—Ä–æ—Å–∞–µ–º—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, NullPointerException, ArrayIndexOutOfBoundsException, ArithmeticException, ClassCastException –∏ –¥—Ä.) –ø–µ—Ä–µ—Å—Ç–∞—é—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å —Å—Ç–µ–∫ –ø–æ—Å–ª–µ ¬´–ø—Ä–æ–≥—Ä–µ–≤–∞¬ª –∫–æ–¥–∞.

–ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç:

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (OmitStackTraceInFastThrow = true) –ø—Ä–∏ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã—Ö NPE/AIOOBE –∏ —Ç.–ø. JVM –Ω–∞—á–∏–Ω–∞–µ—Ç –∫–∏–¥–∞—Ç—å ¬´–±—ã—Å—Ç—Ä—ã–µ¬ª —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –±–µ–∑ stacktrace (—ç–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ fillInStackTrace()).

–° —Ñ–ª–∞–≥–æ–º -XX:-OmitStackTraceInFastThrow —Å—Ç–µ–∫ –±—É–¥–µ—Ç –≤—Å–µ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è, –∏ —Ç—ã —É–≤–∏–¥–∏—à—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π stacktrace —Ç–∞–º, –≥–¥–µ —Ä–∞–Ω—å—à–µ –æ–Ω –ø—Ä–æ–ø–∞–¥–∞–ª.

---

## 2) Thread dump

### –ß—Ç–æ —ç—Ç–æ (–ø–æ‚Äë–ø—Ä–æ—Å—Ç–æ–º—É)
**Thread dump** ‚Äî –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–Ω–∏–º–æ–∫ **–≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤** –ø—Ä–æ—Ü–µ—Å—Å–∞: –∏–º—è, —Å–æ—Å—Ç–æ—è–Ω–∏–µ (`RUNNABLE/BLOCKED/WAITING`), —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤ –∏ —É–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ/–æ–∂–∏–¥–∞–µ–º—ã–µ –∑–∞–º–∫–∏.

### –ó–∞—á–µ–º
- ¬´–ø–æ–¥–≤–∏—Å–∞–Ω–∏–µ¬ª, —Ç–∞–π–º–∞—É—Ç—ã, –æ—á–µ—Ä–µ–¥–∏;
- –≤—ã—Å–æ–∫–∏–π CPU ‚Äî –Ω–∞–π—Ç–∏ ¬´–≥–æ—Ä—è—á–∏–π¬ª –ø–æ—Ç–æ–∫ –∏ –º–µ—Å—Ç–æ –≤ –∫–æ–¥–µ;
- –≤–∑–∞–∏–º–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ ‚Äî JVM –ø–æ–∫–∞–∂–µ—Ç –±–ª–æ–∫ **Found one Java-level deadlock**.

### –ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç (–æ—á–µ–Ω—å –∫—Ä–∞—Ç–∫–æ)
```
"worker-7" nid=0x1a RUNNABLE
  at com.acme.Service.loop(Service.java:42)
"pool-1-thread-3" WAITING
  at java.util.concurrent.FutureTask.get(...)
"cache-writer" BLOCKED
  - waiting to lock <0xABCD> held by "cache-reader"
```

### –°–∫–æ–ª—å–∫–æ —Å–Ω–∏–º–∞—Ç—å
–°–¥–µ–ª–∞–π **3‚Äì5 –¥–∞–º–ø–æ–≤** —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º **5‚Äì10 —Å**, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–∏–Ω–∞–º–∏–∫—É (–¥–≤–∏–∂–µ—Ç—Å—è –ª–∏ —Å—Ç–µ–∫).

**–ö–æ–≥–¥–∞ —Å–Ω–∏–º–∞—Ç—å:** –ø–æ–¥–≤–∏—Å–∞–Ω–∏—è, –≤—ã—Å–æ–∫–∏–π CPU, —Ç–∞–π–º–∞—É—Ç—ã, deadlock. –°–Ω–∏–º–∏ 3‚Äì5 –¥–∞–º–ø–æ–≤ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 5‚Äì10 —Å–µ–∫.

**–ö–∞–∫ —Å–Ω—è—Ç—å:**
```bash
jcmd <pid> Thread.print                 # —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
jstack -l <pid>
kill -3 <pid>                           # Unix: –¥–∞–º–ø –≤ stdout –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

–µ—â–µ –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –∏–∑ Java - Thread.getAllStackTraces


**–ö–∞–∫ —á–∏—Ç–∞—Ç—å:**
- –°–æ—Å—Ç–æ—è–Ω–∏—è: `RUNNABLE` (CPU/IO), `BLOCKED` (–º–æ–Ω–∏—Ç–æ—Ä), `WAITING/TIMED_WAITING` (–æ–∂–∏–¥–∞–Ω–∏–µ/–ø–∞—Ä–∫–æ–≤–∫–∞).
- –ò—â–∏ ¬´Owner¬ª, ¬´parking to wait for‚Ä¶¬ª, Java-–º—å—é—Ç–µ–∫—Å—ã (`ReentrantLock`), `synchronized (this)`.
- –î–µ—Ç–µ–∫—Ç –¥–µ–¥–ª–æ–∫–∞: –±–ª–æ–∫ `Found one Java-level deadlock`.
- –ì–æ—Ä—è—á–∏–µ –Ω–∏—Ç–∏: `top -H` ‚Üí —Å–æ–ø–æ—Å—Ç–∞–≤—å `nid` –∏–∑ –¥–∞–º–ø–∞.

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:** IntelliJ IDEA, https://jstack.review

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [–ö–æ–Ω—Ç–µ–Ω—à–Ω –∏ –î–µ–¥–ª–æ–∫](contention-vs-deadlock.md)

---

## 3) Heap dump

### –ß—Ç–æ —ç—Ç–æ (–ø–æ‚Äë–ø—Ä–æ—Å—Ç–æ–º—É)
**Heap dump** ‚Äî ¬´—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è¬ª **–∫—É—á–∏ Java** –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏: –æ–±—ä–µ–∫—Ç—ã, –ø–æ–ª—è/—Å—Å—ã–ª–∫–∏, –º–∞—Å—Å–∏–≤—ã, –∫–ª–∞—Å—Å—ã/–∫–ª–∞—Å—Å‚Äë–ª–æ–∞–¥–µ—Ä—ã –∏ **GC‚Äë–∫–æ—Ä–Ω–∏**.  
üëâ **–ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç** —Å—Ç–µ–∫–∏ –ø–æ—Ç–æ–∫–æ–≤ –∏ –º–µ—Å—Ç–∞, –≥–¥–µ –æ–±—ä–µ–∫—Ç –±—ã–ª —Å–æ–∑–¥–∞–Ω.

### –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω
- `OutOfMemoryError` (–æ—Å–æ–±–µ–Ω–Ω–æ `Java heap space`);
- –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º –≤–∏–¥–Ω–æ **—Ä–æ—Å—Ç heap** / –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ —É—Ç–µ—á–∫—É.

### –ö–∞–∫ —Å–Ω—è—Ç—å
- –ê–≤—Ç–æ –ø—Ä–∏ OOME: `-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/dumps`
- –í—Ä—É—á–Ω—É—é: `jcmd <PID> GC.heap_dump /path/heap.hprof`  
  (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: `jmap -dump:...` ‚Äî `:live` –¥–µ–ª–∞–µ—Ç Full GC –∏ –¥–æ–ª—å—à–µ).
- –í Kubernetes: `kubectl exec -it <pod> -- jcmd 1 GC.heap_dump /dumps/heap.hprof`

> –§–∞–π–ª –º–æ–∂–µ—Ç –≤–µ—Å–∏—Ç—å ~–æ–±—ä—ë–º –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –∫—É—á–∏. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø—É—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –∑–∞–ø–∏—Å—å (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ ‚Äî —Å–º–æ–Ω—Ç–∏—Ä—É–π volume).

### –ß–µ–º –æ—Ç–∫—Ä—ã–≤–∞—Ç—å
- **VisualVM** –∏–ª–∏ **Eclipse MAT** –¥–ª—è `.hprof`.  
- **JDK Mission Control** ‚Äî –¥–ª—è **JFR** (–æ–Ω –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `.hprof`).

### –ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ
- **Dominator Tree** + **Retained Size** ‚Äî ¬´–∫—Ç–æ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–∞–º—è—Ç–∏¬ª.
- **GC Roots / Nearest GC Root** ‚Äî –ø—É—Ç—å —É–¥–µ—Ä–∂–∞–Ω–∏—è (—á–∞—Å—Ç–æ: `static` –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –∫—ç—à–∏, `ThreadLocal`, –∫–ª–∞—Å—Å‚Äë–ª–æ–∞–¥–µ—Ä—ã).
- **Class Histogram** ‚Äî –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∏–ø—ã –∏ –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.

### –ë—ã—Å—Ç—Ä—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —á—Ç–µ–Ω–∏—è
1. –ù–∞–∂–º–∏ **Compute Retained Sizes**.
2. –û—Ç—Å–æ—Ä—Ç–∏—Ä—É–π –∫–ª–∞—Å—Å—ã –ø–æ **Retained Size** ‚Äî –Ω–∞–π–¥–∏ ¬´–∫–∏—Ç–æ–≤¬ª.
3. –û—Ç–∫—Ä–æ–π ¬´–∫–∏—Ç–∞¬ª –≤ **Dominator Tree**, –ø–æ—Å–º–æ—Ç—Ä–∏ –ø—É—Ç—å –¥–æ GC‚Äëroot.
4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –ª–æ–≥–∏–∫—É: –∫—Ç–æ –∫–ª–∞–¥—ë—Ç/–Ω–µ —á–∏—Å—Ç–∏—Ç? –ò—Å–ø—Ä–∞–≤—å –∫–æ–¥/—Ä–∞–∑–º–µ—Ä—ã –∫—ç—à–∞/–∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª.

### –ß–∞—Å—Ç—ã–µ –ª–æ–≤—É—à–∫–∏
- `:live` –≤ `jmap` –º–æ–∂–µ—Ç ¬´–∑–∞–º–æ—Ä–æ–∑–∏—Ç—å¬ª –Ω–∞ –¥–æ–ª—å—à–µ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–∫–∫—É—Ä–∞—Ç–Ω–æ.
- –ë–æ–ª—å—à–∏–µ –º–∞—Å—Å–∏–≤—ã/–±—É—Ñ–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `byte[]`) –º–æ–≥—É—Ç ¬´–º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å¬ª –≤–ª–∞–¥–µ–ª—å—Ü–∞; —Å–º–æ—Ç—Ä–∏, –∫—Ç–æ –Ω–∞ –Ω–∏—Ö —Å—Å—ã–ª–∞–µ—Ç—Å—è.
- Heap dump **–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç** ¬´–∫—Ç–æ —Å–æ–∑–¥–∞–ª¬ª ‚Äî –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π JFR (Allocation/Old Object Sample).

**–ö–æ–≥–¥–∞:** –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ —É—Ç–µ—á–∫—É/–∞–Ω–æ–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç –∫—É—á–∏, `OutOfMemoryError: Java heap space`.

**–ö–∞–∫ —Å–Ω—è—Ç—å:**
```bash
jcmd <pid> GC.heap_dump /path/heap.hprof           # –æ–Ω–ª–∞–π–Ω
jmap -dump:live,format=b,file=heap.hprof <pid>
# –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ OOME:
-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/dumps
# –º–æ–∂–Ω–æ –¥–∞–º–ø–∏—Ç—å –¥–æ –ø–æ–ª–Ω–æ–π –∏–ª–∏ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞
-XX:+HeapDumpBeforeFullGC
-XX:+HeapDumpAfterFullGC
# –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –ø—É—Ç—å
-XX:HeapDumpPath=/tmp (or /tmp/dump.bin
```

**–ß–µ–º —á–∏—Ç–∞—Ç—å:** VisualVM, Eclipse MAT, JMC (–¥–ª—è JFR, —Å–º. –≤—ã—à–µ).  
**–ö–∞–∫ —á–∏—Ç–∞—Ç—å:** *Dominator Tree* ‚Üí –±–æ–ª—å—à–∏–µ **retained size**; *Leak Suspects*; *GC Roots*; *Class Histogram*; –ø—Ä–æ–≤–µ—Ä—å —É–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, `ThreadLocal`, –∫–ª–∞—Å—Å-–ª–æ–∞–¥–µ—Ä—ã.
---

## 4) Core dump (native crash) - ¬´—Å–Ω–∏–º–æ–∫ –ø—Ä–∏ —Å–º–µ—Ä—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞¬ª

core dump –Ω–µ–ª—å–∑—è "–≤—ã–∑–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é" —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ JVM –≤—Ä–æ–¥–µ jcmd –∏–ª–∏ jmap, –ø–æ—Ç–æ–º—É —á—Ç–æ:
–æ–Ω —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–µ —Å–∞–º–æ–π JVM, –∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π, –∏ —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å –∫—Ä–∞—à–∏—Ç—Å—è (–∞–≤–∞—Ä–∏–π–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è).

–∏–∑ –Ω–µ–æ—á–µ–≤–∏–¥–Ω–æ–≥–æ: –¥–æ–ø—É—Å—Ç–∏–º, —É–º–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å –∏ –º—ã –Ω–µ –º–æ–∂–µ–º —Å–Ω—è—Ç—å heap dump —Å –Ω–µ–≥–æ, —Ç–æ–≥–¥–∞ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å core dump –∏ –ø–æ—Ç–æ–º –Ω–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –¥–∞–º–ø "–Ω–∞—Ç—Ä–∞–≤–∏—Ç—å" jmap (—ç—Ç–æ –∏–∑ –≤–∏–¥–µ–æ –ü–∞–Ω—å–≥–∏–Ω–∞)

### –ß—Ç–æ —ç—Ç–æ (–ø–æ-–ø—Ä–æ—Å—Ç–æ–º—É)

**Core dump** ‚Äî —ç—Ç–æ ¬´—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è¬ª **–≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞** –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.  
–ï—Å–ª–∏ heap dump –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã Java, —Ç–æ core dump ‚Äî –≤—Å—é –ø–∞–º—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞:  
–∫—É—á—É, –Ω–∞—Ç–∏–≤–Ω—ã–µ —Å—Ç—ç–∫–∏, —Ä–µ–≥–∏—Å—Ç—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞, –Ω–∞—Ç–∏–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –≤—Å—ë, —á—Ç–æ –±—ã–ª–æ –≤ RAM.

> üìç Core dump —Å–æ–∑–¥–∞—ë—Ç—Å—è **–ø—Ä–∏ –∞–≤–∞—Ä–∏–π–Ω–æ–º –ø–∞–¥–µ–Ω–∏–∏ JVM** ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑-–∑–∞ —Å–±–æ—è –≤ JNI-–∫–æ–¥–µ, –±–∞–≥–∞ JIT-–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ –∏–ª–∏ –æ—à–∏–±–∫–∏ –ø–∞–º—è—Ç–∏ (`SIGSEGV`, `SIGBUS` –∏ —Ç.–ø.).  
> –í –æ–±—ã—á–Ω–æ–π —Ä–∞–±–æ—Ç–µ core dump –Ω–µ —Å–Ω–∏–º–∞–µ—Ç—Å—è.

---

### –ß—Ç–æ –≤ –Ω–µ–≥–æ –ø–æ–ø–∞–¥–∞–µ—Ç
- –í—Å—è –ø–∞–º—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ (–≤–∫–ª—é—á–∞—è Java-heap, Metaspace, native-heap, thread-—Å—Ç–µ–∫–∏);
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞;
- –ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö `.so`/`.dll` –±–∏–±–ª–∏–æ—Ç–µ–∫;
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –û–° (PID, UID, timestamp, —Å–∏–≥–Ω–∞–ª, –≤–µ—Ä—Å–∏—è —è–¥—Ä–∞).

---

### –ö–∞–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
JVM –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç—å –û–° —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å core-—Ñ–∞–π–ª, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã —Ñ–ª–∞–≥–∏:

```bash
-XX:+CreateCoredumpOnCrash
-XX:ErrorFile=/logs/hs_err_pid%p.log
```

üß© –¢–æ–≥–¥–∞ —Ç—ã –ø–æ–ª—É—á–∏—à—å –¥–≤–∞ —Ñ–∞–π–ª–∞:
- `hs_err_pidXXXX.log` ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç—á—ë—Ç JVM (—É–∫–∞–∑–∞–Ω–∏–µ, –≥–¥–µ —É–ø–∞–ª–æ);
- `core` ‚Äî –±–æ–ª—å—à–æ–π –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª (–≤—Å—è –ø–∞–º—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞).

> ‚ö†Ô∏è –§–∞–π–ª –º–æ–∂–µ—Ç –≤–µ—Å–∏—Ç—å –≥–∏–≥–∞–±–∞–π—Ç—ã. –ù–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö core dump –æ–±—ã—á–Ω–æ –æ—Ç–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`ulimit -c 0`).

---

### –ö–∞–∫ —á–∏—Ç–∞—Ç—å
- –ù–∞ —É—Ä–æ–≤–Ω–µ –û–°:
  ```bash
  gdb java core
  # –∏–ª–∏
  lldb -c core
  ```
  –≠—Ç–æ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π C/ASM-—É—Ä–æ–≤–µ–Ω—å.
- –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ **Java-—Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ** –∏—Å–ø–æ–ª—å–∑—É–π `jhsdb` (–≤ JDK 9+):
  ```bash
  jhsdb jstack --core core --exe /path/to/java
  jhsdb jmap   --core core --exe /path/to/java
  jhsdb info   --core core --exe /path/to/java
  ```

---

### –ö–æ–≥–¥–∞ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è
- JVM **—É–ø–∞–ª–∞ —Å segfault** (`hs_err_pid` —É–ø–æ–º–∏–Ω–∞–µ—Ç SIGSEGV, SIGBUS, SIGILL);
- —Å–±–æ–π –≤ **native-–±–∏–±–ª–∏–æ—Ç–µ–∫–µ** (JNI, OpenSSL, –¥—Ä–∞–π–≤–µ—Ä);
- –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏;
- –æ—Ç–ª–∞–¥–∫–∞ ¬´–∫—Ä–∞—à–µ–≤—ã—Ö¬ª –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

---

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –¥–∞–º–ø–∞–º–∏

| –î–∞–º–ø | –£—Ä–æ–≤–µ–Ω—å | –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è | –ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç |
|------|----------|-----------------|---------------|
| **Thread dump** | JVM | –ü–æ –∑–∞–ø—Ä–æ—Å—É (`jcmd`, `kill -3`) | –í—Å–µ –ø–æ—Ç–æ–∫–∏ –∏ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è |
| **Heap dump** | JVM | –ü—Ä–∏ OOME –∏–ª–∏ –≤—Ä—É—á–Ω—É—é (`jmap`) | –û–±—ä–µ–∫—Ç—ã Java-–∫—É—á–∏ |
| **Core dump** | –û–° | –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ JVM | –í—Å—è –ø–∞–º—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ (–≤–∫–ª—é—á–∞—è –Ω–∞—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ) |

---

### –ò—Ç–æ–≥
Core dump ‚Äî —ç—Ç–æ ¬´—á–µ—Ä–Ω—ã–π —è—â–∏–∫¬ª –ø—Ä–æ—Ü–µ—Å—Å–∞.  
–û–Ω –Ω—É–∂–µ–Ω —Ä–µ–¥–∫–æ, –Ω–æ –º–æ–∂–µ—Ç —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –≤—Å—ë, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –º–æ–º–µ–Ω—Ç –∫—Ä–∞—à–∞ ‚Äî  
–Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–∞–∫ JVM, —Ç–∞–∫ –∏ —Å–∞–º–æ–π –û–°.





**–ß—Ç–æ —ç—Ç–æ:** –¥–∞–º–ø –ø—Ä–æ—Ü–µ—Å—Å–∞ —É—Ä–æ–≤–Ω—è –û–° + `hs_err_pid*.log`.

**–ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–ª–∞–≥–∏:**
```bash
-XX:+CreateCoredumpOnCrash
-XX:ErrorFile=/logs/hs_err_pid%p.log
```

**–ê–Ω–∞–ª–∏–∑:**
- –í `hs_err_pid` —Å–º–æ—Ç—Ä–∏ *Problematic frame* (JNI/Unsafe/JIT/libc), –≤–µ—Ä—Å–∏—é JDK, VM Args, —Å–≤–æ–¥–∫—É –ø–∞–º—è—Ç–∏.
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: `jhsdb`/`clhsdb` (–Ω–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥ –ø–æ–≤–µ—Ä—Ö core+exe).

**–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:** –±–∞–≥ –≤ –Ω–∞—Ç–∏–≤–Ω–æ–π –ª–∏–±–µ, –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏, JIT-–±–∞–≥–∏, –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–µ –æ–ø—Ü–∏–∏/–¥—Ä–∞–π–≤–µ—Ä—ã.

–¥–æ–±–∞–≤–ª–µ–Ω–æ ...

-XX:ErrorFile=/tmp/hs_err_pid%p.log 

–≠—Ç–æ –ø—É—Ç—å –∏ —à–∞–±–ª–æ–Ω –∏–º–µ–Ω–∏ –∫—Ä–∞—à-–ª–æ–≥–∞ JVM (hs_err):

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç: —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∫—É–¥–∞ –ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª —Å –æ—Ç—á—ë—Ç–æ–º –æ —Ñ–∞—Ç–∞–ª—å–Ω–æ–π –æ—à–∏–±–∫–µ JVM (native crash, SIGSEGV, internal error, guarantee/assert failure, JIT/JNI –ø–∞–¥–µ–Ω–∏–µ –∏ —Ç.–ø.).
–ü—Ä–∏–º–µ—Ä: /tmp/hs_err_pid12345.log.

–ö–æ–≥–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è: —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ñ–∞—Ç–∞–ª—å–Ω–æ–º –∫—Ä–∞—à–µ JVM. –ü—Ä–∏ –æ–±—ã—á–Ω–æ–º OutOfMemoryError: Java heap space —Ñ–∞–π–ª –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è. –ü–æ—è–≤–∏—Ç—Å—è, –µ—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç—å -XX:+CrashOnOutOfMemoryError (—Ç–æ–≥–¥–∞ OOME –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—Å—è –≤ –∫—Ä–∞—à).

–ü—Ä–æ —à–∞–±–ª–æ–Ω:
hs_err_pid%p.log ‚Äî %p –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ PID –ø—Ä–æ—Ü–µ—Å—Å–∞ (—á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Ç–∏—Ä–∞—Ç—å —Ñ–∞–π–ª—ã). –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å %t –¥–ª—è –º–µ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏:
-XX:ErrorFile=/tmp/hs_err_%p_%t.log.

–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞: –≤–µ—Ä—Å–∏—è JDK/–û–°, VM options, Problematic frame, —Å—Ç–µ–∫ —É–ø–∞–≤—à–µ–≥–æ –ø–æ—Ç–æ–∫–∞ (Java+native), –∫–∞—Ä—Ç–∞ –ø–∞–º—è—Ç–∏, —Å–µ–∫—Ü–∏–∏ Heap/NMT, —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ ‚Äî —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ native-–ø–∞–¥–µ–Ω–∏–π.

–ö–æ–º–±–æ: —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤–º–µ—Å—Ç–µ —Å

-XX:+CreateCoredumpOnCrash

—á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –µ—â—ë –∏ core-dump —Ä—è–¥–æ–º —Å hs_err.

---

## 5) Code Cache –≤ JVM

### –ß—Ç–æ —ç—Ç–æ (–ø–æ-–ø—Ä–æ—Å—Ç–æ–º—É)

–ö–æ–≥–¥–∞ Java-–ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, **JVM –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ—Ç –±–∞–π—Ç–∫–æ–¥ –Ω–∞–ø—Ä—è–º—É—é –∫–∞–∂–¥—ã–π —Ä–∞–∑**.  
–û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **JIT-–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä** (*Just-In-Time*), –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —á–∞—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º—ã–µ –º–µ—Ç–æ–¥—ã –≤ **–º–∞—à–∏–Ω–Ω—ã–π –∫–æ–¥** –∏ **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç** –µ–≥–æ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –ø–∞–º—è—Ç–∏ ‚Äî **Code Cache**.

> üí° **Code Cache** ‚Äî —ç—Ç–æ —É—á–∞—Å—Ç–æ–∫ *–Ω–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏* (–≤–Ω–µ Java Heap), –≥–¥–µ JVM —Ö—Ä–∞–Ω–∏—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JIT-–º–µ—Ç–æ–¥—ã.

---

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç JIT –∏ Code Cache

1. –ú–µ—Ç–æ–¥ —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–µ.  
2. JVM –∑–∞–º–µ—á–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ –≥–æ—Ä—è—á–∏–π (—á–∞—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è).  
3. JIT-–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –µ–≥–æ –≤ –º–∞—à–∏–Ω–Ω—ã–π –∫–æ–¥.  
4. –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ **Code Cache**.  
5. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –≤—ã–∑–æ–≤–∞—Ö JVM —Å—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–∞—à–∏–Ω–Ω—ã–π –∫–æ–¥ ‚Üí –±—ã—Å—Ç—Ä–µ–µ.

üìç **Code Cache = "–∫—ç—à JIT-–∫–æ–¥–∞"** ‚Äî —á—Ç–æ–±—ã –Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ.

---

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏

–ï—Å–ª–∏ –æ–±–ª–∞—Å—Ç—å Code Cache –∑–∞–ø–æ–ª–Ω–µ–Ω–∞, JVM –ø–∏—à–µ—Ç –≤ –ª–æ–≥:

```
CodeCache is full. Compiler has been disabled.
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:
- JIT –±–æ–ª—å—à–µ –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–∑–º–µ—â–∞—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã;
- –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –±—É–¥—É—Ç –∏—Å–ø–æ–ª–Ω—è—Ç—å—Å—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–æ–º;
- –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç (–≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ).

> ‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É–ø–∞–¥—ë—Ç, –Ω–æ —Å—Ç–∞–Ω–µ—Ç –æ—â—É—Ç–∏–º–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ.

---

### –ö–∞–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

#### 1Ô∏è‚É£ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# JDK 9+
-Xlog:codecache=debug

# JDK 8
-XX:+PrintCodeCache
```
–ë—É–¥–µ—Ç –≤–∏–¥–Ω–æ —Ä–∞–∑–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è.

#### 2Ô∏è‚É£ JMX-–º–µ—Ç—Ä–∏–∫–∞
```
CodeCacheUsage
```
(–º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ VisualVM, JConsole, Prometheus exporter).

#### 3Ô∏è‚É£ –ö–æ–º–∞–Ω–¥–∞ jcmd
```bash
jcmd <pid> Compiler.codecache
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
```
CodeCache: size=240000Kb used=239000Kb max_used=239000Kb free=1000Kb
Compiler has been disabled.
```

---

### –ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å

–û–±—ã—á–Ω–æ Code Cache ‚âà 240‚Äì480 –ú–ë.

```bash
-XX:ReservedCodeCacheSize=512m
```
(–∏–ª–∏ –±–æ–ª—å—à–µ, –µ—Å–ª–∏ –º–Ω–æ–≥–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –∫–ª–∞—Å—Å–æ–≤/–º–µ—Ç–æ–¥–æ–≤).

–î–ª—è –Ω–æ–≤—ã—Ö JVM (JDK 9+) –º–æ–∂–Ω–æ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ç–∏–ø—ã:
```bash
-XX:ProfiledCodeHeapSize=256m
-XX:NonProfiledCodeHeapSize=128m
-XX:NonNMethodCodeHeapSize=32m
```

---

### –ì–¥–µ —ç—Ç–æ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è

- Spring / Hibernate ‚Äî —Å–æ–∑–¥–∞—é—Ç –∫—É—á—É CGLIB-–ø—Ä–æ–∫—Å–∏;  
- Kotlin / Scala / Groovy ‚Äî –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ª—è–º–±–¥—ã –∏ –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ;  
- Framework‚Äô–∏, –∫–æ—Ç–æ—Ä—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –∫–æ–¥ –Ω–∞ –ª–µ—Ç—É (JRuby, Jython, ASM, ByteBuddy);  
- –î–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å –º–∏–ª–ª–∏–æ–Ω–∞–º–∏ –º–µ—Ç–æ–¥–æ–≤ –∏ –∑–∞–≥—Ä—É–∑–∫–∞–º–∏ –∫–ª–∞—Å—Å–æ–≤.

---

### –ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö

```
Compiler queue is full
CodeCache (profiled): size=256M used=256M max_used=256M free=0M
```
–ï—Å–ª–∏ `free=0M` –∏ `Compiler has been disabled` ‚Äî –∫—ç—à –∑–∞–±–∏—Ç.

---

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å

1. –£–≤–µ–ª–∏—á–∏—Ç—å `-XX:ReservedCodeCacheSize` (–¥–æ 512m, 1g ‚Äî –ø–æ —Å–∏—Ç—É–∞—Ü–∏–∏).  
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ—Ç –ª–∏ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∫—Å–∏/–∫–ª–∞—Å—Å–æ–≤.  
3. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –Ω–æ–≤—É—é JDK ‚Äî —É–ª—É—á—à–µ–Ω–Ω—ã–π JIT –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º.  
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å `CodeCacheUsage` —á–µ—Ä–µ–∑ JMX –∏–ª–∏ –ª–æ–≥–∏.  
5. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å tiered compilation:  
   ```bash
   -XX:-TieredCompilation
   ```
   (–¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –Ω–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞).

---

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –æ–±–ª–∞—Å—Ç—è–º–∏ –ø–∞–º—è—Ç–∏

| –û–±–ª–∞—Å—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è | –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç |
|----------|-------------|----------------|-------------|
| **Heap** | Java-–æ–±—ä–µ–∫—Ç—ã | Managed (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è GC) | –û–±—ä–µ–∫—Ç—ã, –º–∞—Å—Å–∏–≤—ã |
| **Metaspace** | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å–æ–≤ | Native | –ö–ª–∞—Å—Å—ã, –º–µ—Ç–æ–¥—ã, Constant Pool |
| **Code Cache** | –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JIT-–∫–æ–¥ | Native | –ú–∞—à–∏–Ω–Ω—ã–π –∫–æ–¥ –º–µ—Ç–æ–¥–æ–≤ |

---

### –ò—Ç–æ–≥

**Code Cache** ‚Äî —ç—Ç–æ —É—á–∞—Å—Ç–æ–∫ –ø–∞–º—è—Ç–∏, –≥–¥–µ JVM —Ö—Ä–∞–Ω–∏—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JIT-–∫–æ–¥.  
–ï—Å–ª–∏ –æ–Ω –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—Å—è, JIT –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è, –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—á–Ω—ë—Ç ¬´—Ç–æ—Ä–º–æ–∑–∏—Ç—å¬ª.  
–ú–æ–Ω–∏—Ç–æ—Ä—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, —É–≤–µ–ª–∏—á–∏–≤–∞–π —Ä–∞–∑–º–µ—Ä –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –º–Ω–æ–≥–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∫–ª–∞—Å—Å–æ–≤.





**–ß—Ç–æ —ç—Ç–æ:** –æ–±–ª–∞—Å—Ç—å —Å–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º JIT-–∫–æ–¥–æ–º.  
**–°–∏–º–ø—Ç–æ–º—ã:** ¬´`CodeCache is full. Compiler has been disabled`¬ª ‚Üí –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# JDK 9+
-Xlog:codecache=debug
# JMX –º–µ—Ç—Ä–∏–∫–∞: CodeCacheUsage
```

**–§–∏–∫—Å—ã:** —É–≤–µ–ª–∏—á–∏—Ç—å `-XX:ReservedCodeCacheSize` (–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî `-XX:ProfiledCodeHeapSize`, `-XX:NonProfiledCodeHeapSize`), –æ–±–Ω–æ–≤–∏—Ç—å JDK, —É–º–µ–Ω—å—à–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—Ä–æ–∫—Å–∏.

---

## 6) Profiling –≤ JVM

–ü—Ä–∞–∫—Ç–∏—á–Ω—ã–π –≥–∏–¥: –∑–∞—á–µ–º, —á–µ–º –∏ –∫–∞–∫ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞—Ç—å Java‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –°—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω‚Äë–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å–ø–æ—Å–æ–±–∞—Ö (async-profiler, JFR) –∏ –±—ã—Å—Ç—Ä—ã—Ö —à–∞–≥–∞—Ö.

---

## üß† –ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —ç—Ç–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –∂–∏–≤—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –≤–æ –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å:
- –≥–¥–µ —Å–≥–æ—Ä–∞–µ—Ç **CPU** (–≥–æ—Ä—è—á–∏–µ –º–µ—Ç–æ–¥—ã/—Å—Ç—ç–∫–∏),
- –≥–¥–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è **—Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è** (–æ–∂–∏–¥–∞–Ω–∏—è: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, IO, syscalls),
- –∫—Ç–æ –¥–µ–ª–∞–µ—Ç **–Ω–∞–∏–±–æ–ª—å—à–µ–µ —á–∏—Å–ª–æ –∞–ª–ª–æ–∫–∞—Ü–∏–π** (–º—É—Å–æ—Ä –∏ –¥–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ GC),
- –≥–¥–µ –µ—Å—Ç—å **lock contention** (–ø—Ä–æ–±–∫–∏ –Ω–∞ –∑–∞–º–∫–∞—Ö).

> –ï—Å–ª–∏ thread dump ‚Äî ¬´—Ñ–æ—Ç–æ¬ª, —Ç–æ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî ¬´–≤–∏–¥–µ–æ–∑–∞–ø–∏—Å—å¬ª –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫–æ–¥–∞.

---

## üß∞ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –∫–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ß—Ç–æ –¥–∞—ë—Ç | –ù–∞–≥—Ä—É–∑–∫–∞ | –ì–¥–µ –∑–∞–ø—É—Å–∫–∞—Ç—å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---|---|---|---|---|
| **async-profiler** | CPU / Wall / Alloc / Lock, Flame Graph | –Ω–∏–∑–∫–∞—è (<2%) | –ø—Ä–æ–¥/—Å—Ç–µ–π–¥–∂/–ª–æ–∫–∞–ª | —Å–∞–º—ã–π —Ç–æ—á–Ω—ã–π –∏ –ª—ë–≥–∫–∏–π; CLI |
| **JFR (Java Flight Recorder)** | CPU, GC, IO, –∞–ª–ª–æ–∫–∞—Ü–∏–∏, —Å–æ–±—ã—Ç–∏—è JVM | –Ω–∏–∑–∫–∞—è (1‚Äì2%) | –ø—Ä–æ–¥/—Å—Ç–µ–π–¥–∂/–ª–æ–∫–∞–ª | –≤—Å—Ç—Ä–æ–µ–Ω –≤ JDK; –∞–Ω–∞–ª–∏–∑ –≤ JMC |
| **JMC / VisualVM** | GUI‚Äë–∞–Ω–∞–ª–∏–∑ (JFR/heap –∏ —Ç.–ø.) | ‚Äî | –ª–æ–∫–∞–ª/–æ—Ñ–ª–∞–π–Ω | —É–¥–æ–±–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è |
| **YourKit / JProfiler** | –≥–ª—É–±–æ–∫–∞—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ | —Å—Ä–µ–¥–Ω—è—è | —Å—Ç–µ–π–¥–∂/–ª–æ–∫–∞–ª | –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ, —É–¥–æ–±–Ω—ã–µ –≤ IDE |

---

## ‚öôÔ∏è async-profiler (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∫–∞–∫ ¬´–ø–µ—Ä–≤—ã–π –Ω–æ–º–µ—Ä¬ª)

**–ó–∞–ø—É—Å–∫–∏ (—Å–∞–º–æ–µ –Ω—É–∂–Ω–æ–µ):**
```bash
# 30 —Å–µ–∫ CPU-–ø—Ä–æ—Ñ–∏–ª—å
./profiler.sh -d 30 -e cpu   -f cpu.svg   <pid>

# 30 —Å–µ–∫ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (—É—á–∏—Ç—ã–≤–∞–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è/IO/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
./profiler.sh -d 30 -e wall  -f wall.svg  <pid>

# 30 —Å–µ–∫ –∞–ª–ª–æ–∫–∞—Ü–∏–π (–∫—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤)
./profiler.sh -d 30 -e alloc -f alloc.svg <pid>

# 30 —Å–µ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (lock contention)
./profiler.sh -d 30 -e lock  -f lock.svg  <pid>
```

–û—Ç–∫—Ä–æ–π `*.svg` –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî —ç—Ç–æ **flame graph**: —à–∏—Ä–∏–Ω–∞ ¬´–ø–ª–∞–º–µ–Ω–∏¬ª = –¥–æ–ª—è –≤—Ä–µ–º–µ–Ω–∏/CPU.  
–°–Ω–∏–∑—É –≤–≤–µ—Ä—Ö ‚Äî —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤, —Å–ª–µ–≤–∞‚Äë–Ω–∞–ø—Ä–∞–≤–æ ‚Äî ¬´—à–∏—Ä–µ = –≥–æ—Ä—è—á–µ–µ¬ª.

**–®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ —á—Ç–µ–Ω–∏—é flame graph:**
- –ò—â–∏ **—à–∏—Ä–æ–∫–∏–µ –ø–ª–∞—Å—Ç–∏–Ω—ã** –≤–≤–µ—Ä—Ö—É (–∫–æ–Ω–µ—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã) –∏ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ (–æ–±—â–∏–µ –ø—É—Ç–∏).
- –°—Ä–∞–≤–Ω–∏ `cpu.svg` –∏ `wall.svg`: –µ—Å–ª–∏ `wall` —à–∏—Ä–µ ‚Äî –∑–Ω–∞—á–∏—Ç –∂–¥—ë—à—å (IO/–ª–æ–∫–∏).
- –í `alloc.svg` ‚Äî –∫–ª–∞—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ ¬´–º—É—Å–æ—Ä—è—Ç¬ª –∏ –¥–∞–≤—è—Ç –Ω–∞ GC.

> –ü—Ä–∏–º–µ—á–∞–Ω–∏—è: –Ω–∞ Linux –Ω—É–∂–µ–Ω `perf_event_paranoid`/`kernel.kptr_restrict` –≤ –∞–¥–µ–∫–≤–∞—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö (–æ–±—ã—á–Ω–æ –≤ –ø—Ä–æ–¥–µ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ).

---

## ‚öôÔ∏è JFR (Java Flight Recorder)

**–°—Ç–∞—Ä—Ç/—Å—Ç–æ–ø —á–µ—Ä–µ–∑ `jcmd`:**
```bash
# –ü—Ä–æ—Ñ–∏–ª—å –Ω–∞ 2 –º–∏–Ω—É—Ç—ã
jcmd <pid> JFR.start name=profile settings=profile filename=/tmp/run.jfr duration=2m
# (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –¥–∞–º–ø –≤ —Ñ–∞–π–ª
jcmd <pid> JFR.dump  name=profile filename=/tmp/run.jfr
# –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
jcmd <pid> JFR.stop  name=profile
```

**–ê–Ω–∞–ª–∏–∑:** –æ—Ç–∫—Ä–æ–π `/tmp/run.jfr` –≤ **JDK Mission Control (JMC)**.  
–¢–∞–º –µ—Å—Ç—å –≤–∏–¥—ã: CPU, Allocation, Locks, File/Socket IO, GC, Exceptions, Safepoints, Latency Analysis, Thread overview.

**–°–æ–≤–µ—Ç—ã:**
- –î–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–µ—Å–µ—Ç `settings=profile` (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–µ–π, –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ).  
- –ù–∞ –ø—Ä–æ–¥–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 1‚Äì5 –º–∏–Ω—É—Ç –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ; –≤–∫–ª—é—á–∞–π –≤—ã–±–æ—Ä–æ—á–Ω–æ, —á—Ç–æ–±—ã –Ω–µ —à—É–º–µ—Ç—å –ª–æ–≥–∞–º–∏/–¥–∏—Å–∫–æ–º.

---

## üîé –ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å (—á–µ–∫–ª–∏—Å—Ç)

1. **CPU (async `cpu.svg` –∏–ª–∏ JFR CPU):** —à–∏—Ä–æ–∫–∏–µ –ø–ª–∞—Å—Ç–∏–Ω—ã ‚Üí –≤–∞—à–∏ –º–µ—Ç–æ–¥—ã/—Ü–∏–∫–ª—ã/–ø–∞—Ä—Å–∏–Ω–≥/—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è?  
2. **Wall time (`wall.svg`):** –µ—Å–ª–∏ —à–∏—Ä–µ, —á–µ–º CPU, –∑–Ω–∞—á–∏—Ç **–∂–¥—ë—à—å** ‚Äî —Å–º–æ—Ç—Ä–∏ –≤–µ—Ä—Ö —Å—Ç–µ–∫–∞: `Future.get`, `Selector.select`, `Object.wait`, JDBC/HTTP –≤—ã–∑–æ–≤—ã.  
3. **Allocations (`alloc.svg` / JFR Allocation):** –∫—Ç–æ –≤—ã–¥–µ–ª—è–µ—Ç —á–∞—â–µ –≤—Å–µ–≥–æ ‚Üí —É–º–µ–Ω—å—à–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, –ø—É–ª—ã, –∫–µ—à–∏, —Å—Ç—Ä–∏–º—ã/–±–æ–∫—Å–∏–Ω–≥.  
4. **Locks (`lock.svg` / JFR Locks):** —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ ‚Äî `synchronized`, `ReentrantLock`, `ConcurrentHashMap.compute*`.  
5. **GC/JFR:** —á–∞—Å—Ç—ã–µ –ø–∞—É–∑—ã, high allocation rate, promotion failures ‚Üí —Ç—é–Ω–∏–Ω–≥ –∏–ª–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π.  
6. **Safepoints/JFR:** –¥–æ–ª–≥–∏–µ `Stop-The-World` ‚Üí –ø—Ä–æ–≤–µ—Ä—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é, deopt, Code Cache, –±–æ–ª—å—à–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

## üß™ –ü—Ä–∞–∫—Ç–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞ (–±—ã—Å—Ç—Ä—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã)

**–õ–æ–∫–∞–ª—å–Ω–æ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π:**
```bash
./profiler.sh -d 60 -e cpu -f cpu.svg <pid>
open cpu.svg   # macOS
```

**–ù–∞ —Å—Ç–µ–π–¥–∂–µ/–ø—Ä–æ–¥–µ (JFR):**
```bash
jcmd <pid> JFR.start name=prod settings=profile filename=/tmp/prod.jfr duration=3m
# –ø–æ—Å–ª–µ ‚Äî –∑–∞–±—Ä–∞—Ç—å —Ñ–∞–π–ª –∏ –æ—Ç–∫—Ä—ã—Ç—å –≤ JMC
```

**Kubernetes (–ø—Ä–∏–º–µ—Ä):**
```bash
kubectl exec -it <pod> -- jcmd 1 JFR.start name=pod settings=profile filename=/tmp/pod.jfr duration=2m
kubectl cp <ns>/<pod>:/tmp/pod.jfr ./pod.jfr
```

---

## ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–ª–∏—è–Ω–∏–µ

- **async-profiler** –∏ **JFR** —Å—á–∏—Ç–∞—é—Ç—Å—è –Ω–∏–∑–∫–æ–Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã –¥–ª—è –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –ø—Ä–æ–¥–µ.  
- –ò–∑–±–µ–≥–∞–π ¬´–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ç–æ—Ä–æ–≤¬ª —Å –∏–Ω—Ç—Ä—É–∑–∏–≤–Ω–æ–π bytecode-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –Ω–∞ –ø—Ä–æ–¥–µ (–µ—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω –≤ –∏—Ö –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–∞—Ö).  
- –ü—Ä–æ–≤–µ—Ä—è–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è (perf events / attach / SecurityManager off).

---

## üß≠ –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (—á—Ç–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞)

1) –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, –≥–¥–µ CPU ‚Üí `async-profiler cpu` (30‚Äì60 —Å–µ–∫).  
2) –ü–æ–¥–≤–∏—Å–∞–Ω–∏—è/—Ç–∞–π–º–∞—É—Ç—ã ‚Üí `async-profiler wall` **–∏–ª–∏** JFR.  
3) –ü–∞–º—è—Ç—å/–º—É—Å–æ—Ä ‚Üí `async-profiler alloc` **–∏/–∏–ª–∏** JFR Allocation + –ø–æ—Ç–æ–º heap dump –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.  
4) –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ ‚Üí `async-profiler lock` **–∏–ª–∏** JFR Locks.  

> –ß–∞—Å—Ç–æ —Ö–≤–∞—Ç–∞–µ—Ç 2‚Äì3 –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–µ—Å—Å–∏–π –ø–æ 1‚Äì3 –º–∏–Ω—É—Ç—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —è—Å–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É.

---

## üßæ –ú–∏–Ω–∏-FAQ

- **Flame graph ¬´–ø—Ä—ã–≥–∞–µ—Ç¬ª –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏?** –ù–æ—Ä–º–∞–ª—å–Ω–æ ‚Äî –±–µ—Ä–∏—Ç–µ **–Ω–µ—Å–∫–æ–ª—å–∫–æ** —Å–µ—Å—Å–∏–π –∏ –∏—â–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —à–∏—Ä–æ–∫–∏–µ ¬´–ø–ª–∞—Å—Ç–∏–Ω—ã¬ª.  
- **–ü–æ—á–µ–º—É `wall` —Å–∏–ª—å–Ω–æ —à–∏—Ä–µ `cpu`?** –í—ã —Ç—Ä–∞—Ç–∏—Ç–µ –≤—Ä–µ–º—è –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ (—Å–µ—Ç—å/–¥–∏—Å–∫/–∑–∞–º–∫–∏). –ò—â–∏—Ç–µ –≤–µ—Ä—Ö–Ω–∏–µ –∫–∞–¥—Ä—ã.  
- **–ú–æ–∂–Ω–æ –ª–∏ –≤–∫–ª—é—á–∏—Ç—å JFR –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ?** –î–∞: `-XX:StartFlightRecording=filename=/tmp/app.jfr,settings=profile`.  
- **–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ perf (Linux)?** –ü–æ–ø—Ä–æ—Å–∏ DevOps —Å–Ω–∏–∑–∏—Ç—å `kernel.perf_event_paranoid`, –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π JFR.

---

## –ò—Ç–æ–≥
–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± –ø–æ–Ω—è—Ç—å, *–≥–¥–µ –∏–º–µ–Ω–Ω–æ* —É—Ç–µ–∫–∞–µ—Ç –≤—Ä–µ–º—è/CPU/–ø–∞–º—è—Ç—å.  
–ù–∞—á–∏–Ω–∞–π —Å `async-profiler` (CPU/Wall/Alloc/Lock), –¥–ª—è —Å–æ–±—ã—Ç–∏–π JVM –∏ –æ—Ñ–ª–∞–π–Ω‚Äë–∞–Ω–∞–ª–∏–∑–∞ ‚Äî **JFR + JMC**. –°–æ—Ö—Ä–∞–Ω—è–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (`*.svg`, `*.jfr`) ‚Äî –∏—Ö —É–¥–æ–±–Ω–æ —Ä–∞–∑–±–∏—Ä–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ.







### async-profiler (–Ω–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)
```bash
./profiler.sh -d 30 -e cpu  -f cpu.svg   <pid>   # CPU
./profiler.sh -d 30 -e wall -f wall.svg  <pid>   # —Å—Ç–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ (–≤–∏–¥–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/IO)
./profiler.sh -d 30 -e alloc -f alloc.svg <pid>  # –∞–ª–ª–æ–∫–∞—Ü–∏–∏
./profiler.sh -d 30 -e lock  -f lock.svg  <pid>  # –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
```

### JFR (Java Flight Recorder)
```bash
jcmd <pid> JFR.start name=prod settings=profile filename=/tmp/run.jfr duration=5m
jcmd <pid> JFR.dump  name=prod filename=/tmp/run.jfr
jcmd <pid> JFR.stop  name=prod
```
–ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ JMC: —Å–æ–±—ã—Ç–∏—è GC, CPU, file/net IO, –∞–ª–ª–æ–∫–∞—Ü–∏–∏, latency.

---

## 7) Monitoring (Grafana –∏ –¥—Ä.)

# Monitoring –≤ JVM (–ø.7)

---

## üß† –ß—Ç–æ —Ç–∞–∫–æ–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**Monitoring** ‚Äî —ç—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ JVM –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –≤–æ –≤—Ä–µ–º–µ–Ω–∏:  
—Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (CPU, –ø–∞–º—è—Ç—å, GC, –ø–æ—Ç–æ–∫–∏, latency, throughput) –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ –¥–∞—à–±–æ—Ä–¥–∞—Ö.

> üîπ –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—á–∞–µ—Ç *–ø–æ—á–µ–º—É —Å–µ–π—á–∞—Å –º–µ–¥–ª–µ–Ω–Ω–æ*,  
> üîπ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî *—á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –∏ –∫–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ*.

---

## üß© –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏

- –°–ª–µ–¥–∏—Ç—å –∑–∞ **–ø–∞–º—è—Ç—å—é** (Heap, Metaspace, Off-Heap);
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å **GC-–ø–∞—É–∑—ã** –∏ —á–∞—Å—Ç–æ—Ç—É —Å–±–æ—Ä–æ–∫;
- –ù–∞–±–ª—é–¥–∞—Ç—å **–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤**, –æ—á–µ—Ä–µ–¥–µ–π, –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤;
- –î–µ—Ä–∂–∞—Ç—å –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º **CPU**, **IO**, **network**, **latency**;
- –í–æ–≤—Ä–µ–º—è —É–∑–Ω–∞–≤–∞—Ç—å –æ **–æ—à–∏–±–∫–∞—Ö –∏ —É—Ç–µ—á–∫–∞—Ö**.

---

## üß∞ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã JVM-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–∏–º–µ—Ä—ã | –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å |
|------------|----------|----------------|
| **JMX (Java Management Extensions)** | –≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ JVM, `jconsole`, `VisualVM`, `Prometheus JMX Exporter` | –±–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –ª—é–±–æ–π Java-—Å–µ—Ä–≤–∏—Å |
| **Metrics API / Micrometer** | `Micrometer`, `Dropwizard Metrics`, `Micronaut metrics` | –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus/Grafana |
| **Prometheus + Grafana** | `jmx_exporter`, `otel-collector`, `Micrometer Registry` | —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-–¥–∞—à–±–æ—Ä–¥–æ–≤ |
| **APM** | `New Relic`, `Datadog`, `AppDynamics`, `Elastic APM` | —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ |
| **JFR Streaming** | `jcmd JFR.configure` + JDK Flight Recorder API | –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ –∞–≥–µ–Ω—Ç–æ–≤ |

---

## ‚öôÔ∏è JVM –º–µ—Ç—Ä–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç | –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å |
|----------|----------------|---------------|
| `java.lang:type=Memory` | Heap/Non-Heap, usage, peak | JMX, VisualVM |
| `java.lang:type=GarbageCollector` | –≤—Ä–µ–º—è –∏ —á–∞—Å—Ç–æ—Ç–∞ GC | JMX, Prometheus |
| `java.lang:type=Threading` | –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ—Ç–æ–∫–∏, daemon, deadlock | JMX, jconsole |
| `java.lang:type=OperatingSystem` | CPU load, file descriptors | JMX |
| `CodeCacheUsage` | –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—ç—à–∞ JIT | JMX, jcmd |
| `ClassLoading` | –∑–∞–≥—Ä—É–∑–∫–∞/–≤—ã–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Å–æ–≤ | JMX |

---

## üìä –ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ú–µ—Ç—Ä–∏–∫–∞ | –ü–æ—Ä–æ–≥ / —Å–∏–º–ø—Ç–æ–º |
|------------|----------|----------------|
| **–ü–∞–º—è—Ç—å** | Heap usage > 80% | –≤–æ–∑–º–æ–∂–Ω–∞—è —É—Ç–µ—á–∫–∞ |
| | Metaspace —Ä–∞—Å—Ç—ë—Ç | —á–∞—Å—Ç—ã–µ classloader-—Å–æ–∑–¥–∞–Ω–∏—è |
| **GC** | Pause time > 200 ms | GC-pressure |
| | Full GC —á–∞—Å—Ç–æ | –Ω–µ—Ö–≤–∞—Ç–∫–∞ heap |
| **CPU** | > 80% –¥–æ–ª—å—à–µ 1 –º–∏–Ω | –≥–æ—Ä—è—á–∏–µ —Ü–∏–∫–ª—ã, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è |
| **–ü–æ—Ç–æ–∫–∏** | > N –±–∞–∑–æ–≤–æ–π –Ω–æ—Ä–º—ã | —É—Ç–µ—á–∫–∏, –∑–∞–≤–∏—Å–∞–Ω–∏—è |
| **Code Cache** | > 95% | JIT-–∫–æ–º–ø–∏–ª—è—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è |
| **Latency / Errors** | p95 latency —Ä–∞—Å—Ç—ë—Ç, error rate > 0.5% | –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è |

---

## üîç –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏

### Prometheus JMX Exporter
```bash
java -javaagent:jmx_prometheus_javaagent.jar=8080:config.yaml -jar app.jar
```
–ü—Ä–∏–º–µ—Ä `config.yaml`:
```yaml
rules:
  - pattern: 'java.lang<type=Memory><HeapMemoryUsage>(used|committed|max):'
    name: jvm_memory_$1_bytes
    type: GAUGE
```

### Micrometer + Spring Boot Actuator
```groovy
implementation 'io.micrometer:micrometer-registry-prometheus'
implementation 'org.springframework.boot:spring-boot-starter-actuator'
```
‚Üí `/actuator/prometheus` –æ—Ç–¥–∞—ë—Ç –≤—Å–µ JVM + –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏.

---

## üìà –ö–∞–∫ —Å–º–æ—Ç—Ä–µ—Ç—å

- **Grafana** ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∞–ª–µ—Ä—Ç—ã (heap usage, GC time, latency).  
- **VisualVM / JConsole** ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ JVM.  
- **Mission Control (JMC)** ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∂–∏–≤–æ–π JVM (JMX/JFR streaming).  
- **APM-—Å–µ—Ä–≤–∏—Å—ã** ‚Äî —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ HTTP, –ë–î, –æ—à–∏–±–æ–∫, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

---

## üßæ –ú–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç Dev/Prod-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

1. –í Dev: VisualVM + JConsole –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫.  
2. –í Stage/Prod: JMX Exporter + Prometheus + Grafana.  
3. –î–ª—è –∞–ª–ª–æ–∫–∞—Ü–∏–π/GC ‚Äî –≤–∫–ª—é—á–∏ JFR streaming.  
4. –î–ª—è –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫ ‚Äî Micrometer + Actuator.  
5. –ù–∞—Å—Ç—Ä–æ–π –∞–ª–µ—Ä—Ç—ã –Ω–∞ heap, GC, CPU, error rate, latency.  
6. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–π –¥–∞—à–±–æ—Ä–¥—ã ‚Äî ¬´—á—Ç–æ–±—ã –Ω–µ —É–∑–Ω–∞—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ –∏–∑ —Ç–∏–∫–µ—Ç–∞¬ª.

---

## –ò—Ç–æ–≥

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî —Ç–≤–æ—è ¬´—Å–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–Ω–µ–≥–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è¬ª.  
–û–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—Ä–µ–Ω–¥—ã, —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —É—Ç–µ—á–∫–∏ –∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –∑–∞–¥–æ–ª–≥–æ –¥–æ –∞–≤–∞—Ä–∏–∏.  
–ö–æ–º–±–∏–Ω–∏—Ä—É–π JMX, Prometheus/Grafana –∏ JFR, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –∫–∞–∫ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ, —Ç–∞–∫ –∏ –±–∏–∑–Ω–µ—Å‚Äë–º–µ—Ç—Ä–∏–∫–∏.







**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Å—Ç–∞ –∫—É–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –≥—Ä–∞—Ñ–∞—Ñ–Ω–µ:**
- **–ü–∞–º—è—Ç—å:** Old/Young usage, allocation rate, —á–∞—Å—Ç–æ—Ç–∞/–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—É–∑ GC.
- **CPU:** user/sys, loadavg, ¬´–≥–æ—Ä—è—á–∏–µ¬ª –ø–æ—Ç–æ–∫–∏; –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö ‚Äî **CPU throttling** (cgroup `throttled_time`).
- **GC time %** (mutator utilization), promotion failures/Full GC.
- **–ü–æ—Ç–æ–∫–∏/–¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã:** JMX/`jcmd VM.system_properties`, NMT.
- **–î–∏—Å–∫/—Å–µ—Ç—å:** iowait, saturation.

**CLI-—Ö–µ–ª–ø:**
```bash
top | pidstat -t 1 | vmstat 1 | iostat -xz 1
jstat -gcutil <pid> 1s
jcmd  <pid> VM.native_memory summary
```

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:** –ø—Ä–æ–≤–µ—Ä—å –ª–∏–º–∏—Ç—ã (`-XX:MaxRAMPercentage`, CPU limits), `OOMKilled`, `CrashLoopBackOff`.

---

## 8) –ê–Ω–∞–ª–∏–∑ –∞–≤–∞—Ä–∏–π–Ω—ã—Ö –¥–∞–º–ø–æ–≤ (–ü–∞–Ω—å–≥–∏–Ω, —á.1‚Äì2)

–§–æ–∫—É—Å –Ω–∞ —á—Ç–µ–Ω–∏–∏ `hs_err_pid`:
- VM Args, –≤–µ—Ä—Å–∏—è JDK/OS, –∫–∞—Ä—Ç–∞ –ø–∞–º—è—Ç–∏.
- –°—Ç–µ–∫ —É–ø–∞–≤—à–µ–≥–æ –ø–æ—Ç–æ–∫–∞, *Problematic frame*.
- –°–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö JNI-–±–∏–±–ª–∏–æ—Ç–µ–∫.
- –§–æ—Ä–º–∏—Ä—É–µ–º –≥–∏–ø–æ—Ç–µ–∑—É: –≥–¥–µ —É–ø–∞–ª–æ (JNI/driver/JIT), –∫–∞–∫–æ–π —à–∞–≥ –∏–∑–æ–ª—è—Ü–∏–∏/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.

---

## 9) –†–∞–∑–±–æ—Ä —Å–ª–æ–∂–Ω—ã—Ö OOM

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–∏–¥—ã –∏ –∫—É–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å:**
- `Java heap space` ‚Üí heap dump, —É–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ —Å—Å—ã–ª–∫–∏.
- `GC overhead limit exceeded` ‚Üí —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–π GC (–æ–±—ã—á–Ω–æ –∏–∑-–∑–∞ —É—Ç–µ—á–µ–∫/–≤—ã—Å–æ–∫–∏—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π).
- `Metaspace` ‚Üí —Ä–æ—Å—Ç –∫–ª–∞—Å—Å–æ–≤/–∫–ª–∞—Å—Å-–ª–æ–∞–¥–µ—Ä–æ–≤ (`-XX:MaxMetaspaceSize`, –∞–Ω–∞–ª–∏–∑ ClassLoader Leak).
- `Direct buffer memory` ‚Üí Netty/NIO; –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π `-XX:MaxDirectMemorySize`, –∏—â–∏ —É—Ç–µ—á–∫–∏ `ByteBuffer`.
- `Unable to create new native thread` ‚Üí –ª–∏–º–∏—Ç –û–°/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ –Ω–∏—Ç—è–º (ulimit/pids), —Ç—Ä–µ–¥-–ª–∏–∫.
- **Native memory leak** (–≤–Ω–µ –∫—É—á–∏): –≤–∫–ª—é—á–∏ NMT –∏ —Å–º–æ—Ç—Ä–∏ –æ—Ç—á—ë—Ç.
```bash
-XX:NativeMemoryTracking=summary   # –∏–ª–∏ detail
jcmd <pid> VM.native_memory summary
```

---

## 10) –ö–ª—é—á–∏ JVM –¥–ª—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∏ –∫—Ä–∞—à–µ

```bash
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=/dumps
-XX:+CreateCoredumpOnCrash
-XX:ErrorFile=/logs/hs_err_pid%p.log

# –ø–ª–∞–Ω –ë (–º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ —Ç—è–∂—ë–ª–æ–º OOM):
-XX:OnError="jcmd %p Thread.print > /logs/threaddump.%p.txt"
-XX:OnOutOfMemoryError="jcmd %p GC.heap_info"
# –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ:
-XX:+CrashOnOutOfMemoryError

# –≤—ã–∫–ª—é—á–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é HotSpot, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π —É —á–∞—Å—Ç–æ –±—Ä–æ—Å–∞–µ–º—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, NullPointerException, ArrayIndexOutOfBoundsException, ArithmeticException, ClassCastException –∏ –¥—Ä.) –ø–µ—Ä–µ—Å—Ç–∞—é—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å —Å—Ç–µ–∫ –ø–æ—Å–ª–µ ¬´–ø—Ä–æ–≥—Ä–µ–≤–∞¬ª –∫–æ–¥–∞.
-XX:-OmitStackTraceInFastThrow
```

---

## 11) –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ GC


# Garbage Collection (GC) –≤ JVM (–ø.8)

---

## üß† –ß—Ç–æ —Ç–∞–∫–æ–µ GC (Garbage Collection)

–ö–æ–≥–¥–∞ —Ç—ã —Å–æ–∑–¥–∞—ë—à—å –æ–±—ä–µ–∫—Ç—ã –≤ Java (`new Something()`), –æ–Ω–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ **–∫—É—á—É (Heap)**.  
–ö–æ–≥–¥–∞ –Ω–∞ –Ω–∏—Ö –±–æ–ª—å—à–µ **–Ω–µ—Ç —Å—Å—ã–ª–æ–∫**, –æ–Ω–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è ¬´–º—É—Å–æ—Ä–æ–º¬ª (garbage).  
**–°–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ (Garbage Collector)** ‚Äî —ç—Ç–æ —á–∞—Å—Ç—å JVM, –∫–æ—Ç–æ—Ä–∞—è **–æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å**, —É–¥–∞–ª—è—è –Ω–µ–Ω—É–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã.

---

## üß© –ö–∞–∫ —ç—Ç–æ —É—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ-–ø—Ä–æ—Å—Ç–æ–º—É

JVM –¥–µ–ª–∏—Ç –∫—É—á—É –Ω–∞ ¬´–ø–æ–∫–æ–ª–µ–Ω–∏—è¬ª (generations):

| –û–±–ª–∞—Å—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ß—Ç–æ –≤ –Ω–µ–π |
|----------|-------------|------------|
| **Young Generation** | –Ω–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã | —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ –±—ã—Å—Ç—Ä–æ —É–º–∏—Ä–∞—é—Ç |
| **Old (Tenured) Generation** | ¬´–¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ¬ª –æ–±—ä–µ–∫—Ç—ã | —Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–∂–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–±–æ—Ä–æ–∫ |
| **Metaspace** | –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å–æ–≤ | –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ heap |

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–±—ä–µ–∫—Ç–∞
1. –û–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ **Eden** (—á–∞—Å—Ç—å Young Gen).  
2. –ï—Å–ª–∏ –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ ¬´Minor GC¬ª ‚Äî –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ Old Gen.  
3. –ö–æ–≥–¥–∞ Old Gen –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **Major (Full) GC**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–π –∫—É—á–µ.

---

## üöÄ –¢–∏–ø—ã GC-—Å–±–æ—Ä—â–∏–∫–æ–≤ (–Ω–∞ –≤—ã–±–æ—Ä JVM)

| –°–±–æ—Ä—â–∏–∫ | –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|----------|------------------|--------------|
| **Serial GC** | –º–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –ø—Ä–æ—Å—Ç–æ–π, –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π |
| **Parallel GC** | —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏ | –±—ã—Å—Ç—Ä—ã–π, –Ω–æ —Å—Ç–æ–ø-–ø–∞—É–∑—ã |
| **G1 GC (Garbage-First)** | –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ JDK 11+ | –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ –ø–∞—É–∑–∞–º–∏ |
| **ZGC / Shenandoah** | –±–æ–ª—å—à–∏–µ –∫—É—á–∏, low-latency —Å–∏—Å—Ç–µ–º—ã | –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—É–∑—ã (<10 –º—Å) |

---

## üß© –ß—Ç–æ –≤–∞–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å

1. **–í—Ä–µ–º—è –ø–∞—É–∑ (Pause Time)** ‚Äî —Å–∫–æ–ª—å–∫–æ JVM ¬´–∑–∞–º–∏—Ä–∞–ª–∞¬ª (Stop-the-World).  
2. **–ß–∞—Å—Ç–æ—Ç–∞ —Å–±–æ—Ä–æ–∫** ‚Äî –∫–∞–∫ —á–∞—Å—Ç–æ –∏–¥—É—Ç Minor/Full GC.  
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Heap** ‚Äî —Ä–∞—Å—Ç—ë—Ç –ª–∏ Old Gen ‚Üí –≤–æ–∑–º–æ–∂–Ω–∞—è —É—Ç–µ—á–∫–∞.  
4. **Promotion failures / Full GC spikes** ‚Üí heap –º–∞–ª –∏–ª–∏ –æ–±—ä–µ–∫—Ç—ã –∂–∏–≤—É—Ç —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ.

---

## ‚öôÔ∏è –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏ GC

### JDK 9+
```bash
-Xlog:gc*,gc+heap=debug:file=gc.log:time,uptime,level,tags
```

### JDK 8
```bash
-XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:gc.log
```

–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–æ–∫–∏:
```
[0.123s][info][gc] GC(0) Pause (G1 Evacuation Pause) 100M->20M(512M) 4.56ms
```
üìñ –î–æ GC –±—ã–ª–æ 100–ú–ë, –ø–æ—Å–ª–µ ‚Äî 20–ú–ë, –ø–∞—É–∑–∞ 4.56 –º—Å.

---

## üîç –ê–Ω–∞–ª–∏–∑ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

- **VisualVM** ‚Üí –≤–∫–ª–∞–¥–∫–∞ *Monitor ‚Üí GC* ‚Äî –≥—Ä–∞—Ñ–∏–∫ –ø–∞—É–∑ –∏ heap.  
- **Java Mission Control (JMC)** ‚Üí JFR ‚Üí GC events.  
- **Grafana / Prometheus** ‚Üí –º–µ—Ç—Ä–∏–∫–∏ `jvm_gc_pause_seconds`, `jvm_memory_used_bytes`.

---

## üß∞ –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–ª–∞–≥–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
-XX:+UseG1GC                            # –≤–∫–ª—é—á–∏—Ç—å G1GC
-XX:MaxGCPauseMillis=200                # —Ü–µ–ª—å –ø–æ –ø–∞—É–∑–∞–º
-XX:InitiatingHeapOccupancyPercent=45   # –∫–æ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞—Ç—å —Å–±–æ—Ä–∫—É
-XX:ConcGCThreads=4                     # –ø–æ—Ç–æ–∫–∏ —Ñ–æ–Ω–æ–≤–æ —Å–æ–±–∏—Ä–∞—é—â–µ–≥–æ GC
```

–î–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤:
```bash
-XX:+UseZGC
-XX:+UseShenandoahGC
```

---

## üö® –ü—Ä–∏–∑–Ω–∞–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å GC

| –°–∏–º–ø—Ç–æ–º | –í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ |
|----------|------------------|
| –ß–∞—Å—Ç—ã–µ Full GC | —É—Ç–µ—á–∫–∞ / –º–∞–ª–µ–Ω—å–∫–∏–π heap |
| –í—ã—Å–æ–∫–∏–π CPU —É GC | —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ |
| –î–æ–ª–≥–∏–µ –ø–∞—É–∑—ã > 1—Å | –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–∏–ø GC |
| Heap –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è | —É—Ç–µ—á–∫–∞, –Ω—É–∂–Ω–∞ heap dump –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ |

---

## üßæ –ö—Ä–∞—Ç–∫–∏–π —á–µ–∫–ª–∏—Å—Ç

1. –í–∫–ª—é—á–∏ GC-–ª–æ–≥–∏ –Ω–∞ —Ç–µ—Å—Ç–µ.  
2. –°–ª–µ–¥–∏, —á—Ç–æ–±—ã Heap usage —Å–Ω–∏–∂–∞–ª—Å—è –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏.  
3. –°–º–æ—Ç—Ä–∏ Pause Time ‚Äî –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ <200 –º—Å.  
4. –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π —Ä–æ—Å—Ç Old Gen.  
5. –ù–∞—Å—Ç—Ä–æ–π GC –ø–æ–¥ —Å–≤–æ–∏ —Ü–µ–ª–∏ (latency / throughput).

---

## üí° –ò—Ç–æ–≥

Garbage Collector ‚Äî —ç—Ç–æ ¬´–¥–≤–æ—Ä–Ω–∏–∫¬ª JVM, —É–±–∏—Ä–∞—é—â–∏–π –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã.  
–ï—Å–ª–∏ –æ–Ω –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è ‚Äî –≤–∫–ª—é—á–∏ GC-–ª–æ–≥–∏, –ø—Ä–æ–≤–µ—Ä—å heap, —Å–¥–µ–ª–∞–π heap dump –∏ –ø–æ–¥–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π —Ç–∏–ø GC.  
–ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –ø–∞—É–∑–∞–º–∏ –∏ –Ω–µ –º–µ—à–∞—Ç—å —Å–±–æ—Ä—â–∏–∫—É —Ä–∞–±–æ—Ç–∞—Ç—å üòÑ








**–í–∫–ª—é—á–µ–Ω–∏–µ:**
```bash
# JDK 9+
-Xlog:gc*,safepoint:file=/logs/gc.log:uptime,level,tags
# JDK 8
-XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:/logs/gc.log -XX:+PrintTenuringDistribution
```

**–ù–∞ —á—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å:** –∞–ª–≥–æ—Ä–∏—Ç–º (Parallel/CMS/G1/ZGC/Shenandoah), —á–∞—Å—Ç–æ—Ç–∞/–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—É–∑, –ø—Ä–∏—á–∏–Ω—ã (Allocation Failure, Metadata GC Threshold, Humongous), –¥–æ–ª–∏ —Ñ–∞–∑ (remark/cleanup), promotion rate, Survivor/Tenuring.

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** GCViewer, gceasy, JMC (JFR GC view).

**–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã/–ø–æ–¥—Ö–æ–¥—ã:**
- –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π **allocation rate** ‚Üí —É–º–µ–Ω—å—à–∏—Ç—å –∞–ª–ª–æ–∫–∞—Ü–∏–∏ (–ø—É–ª—ã/—Ä–µ—é–∑).
- –ß–∞—Å—Ç—ã–µ Young GC + –ø—Ä–æ–º–æ—É—à–µ–Ω—ã ‚Üí —É–≤–µ–ª–∏—á–∏—Ç—å young/heap, —Ç—é–Ω–∏–Ω–≥ G1 (`MaxGCPauseMillis`, `IHOP`).
- Full GC / Promotion failed ‚Üí –Ω–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏/—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è.
- G1 Humongous ‚Üí –∏–∑–±–µ–≥–∞—Ç—å –æ–≥—Ä–æ–º–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, —Ç—é–Ω–∏–Ω–≥ `G1HeapRegionSize`.

---

## 12) –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫-–ª–∏—Å—Ç –ø—Ä–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–µ

1. –ó–∞–±—Ä–∞—Ç—å 3‚Äì5 **thread dump**, **JFR** –Ω–∞ 2‚Äì5 –º–∏–Ω, **GC-–ª–æ–≥–∏**, `hs_err_pid` (–µ—Å–ª–∏ –µ—Å—Ç—å), —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏, –≤–µ—Ä—Å–∏—é JDK –∏ –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ñ–ª–∞–≥–æ–≤:
   ```bash
   jcmd <pid> VM.flags
   jcmd <pid> VM.system_properties
   ```
2. –ï—Å–ª–∏ ¬´–ø–∞–º—è—Ç—å¬ª: **heap dump** (+ NMT –¥–ª—è native).
3. –ï—Å–ª–∏ ¬´–≤—ã—Å–æ–∫–∏–π CPU¬ª: async-profiler (`cpu`/`wall`) + hot threads.
4. –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å **–ª–∏–º–∏—Ç—ã**, **throttling**, —Å—Ç–∞—Ç—É—Å—ã Pod (`OOMKilled`, `CrashLoopBackOff`).

---
